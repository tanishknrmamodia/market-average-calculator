<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Average Calculator ‚Äì Stock Tool</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, #020617, #000000);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      position: relative;
    }

    .container {
      background: linear-gradient(180deg, #020617, #020617cc);
      padding: 28px;
      border-radius: 16px;
      width: 100%;
      max-width: 520px;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.15), 0 30px 60px rgba(0,0,0,0.8);
    }

    .badge {
      text-align: center;
      font-size: 12px;
      letter-spacing: 2px;
      color: #22d3ee;
      margin-bottom: 6px;
    }

    h1 {
      text-align: center;
      margin-bottom: 18px;
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(90deg, #38bdf8, #22d3ee, #4ade80);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .row {
      display: flex;
      gap: 12px;
      margin-bottom: 14px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #020617;
      background: #020617;
      color: #e5e7eb;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(90deg, #38bdf8, #22d3ee);
      color: #020617;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
    }

    .small-btn {
      padding: 10px;
      font-size: 14px;
      margin-top: 6px;
    }

    .result {
      margin-top: 14px;
      padding: 14px;
      background: #020617;
      border-radius: 12px;
      font-size: 14px;
      border: 1px solid rgba(56,189,248,0.2);
    }

    .profit { color: #22c55e; }
    .loss { color: #ef4444; }

    details {
      margin-top: 8px;
      cursor: pointer;
    }

    .footer {
      position: absolute;
      bottom: 10px;
      left: 14px;
      font-size: 12px;
      color: #64748b;
    }

    .footer span { color: #38bdf8; }
  </style>
</head>
<body>
  <div class="container">
    <div class="badge">MARKET TOOL</div>
    <h1>Average Calculator</h1>

    <div class="row">
      <input type="text" id="stock" placeholder="Stock Name / Symbol" />
    </div>

    <div class="row">
      <input type="number" id="buyCount" placeholder="How many times did you buy?" />
    </div>

    <button onclick="generateInputs()">Create Buy Entries</button>
    <div id="inputs"></div>

    <div class="row">
      <input type="number" id="cmp" placeholder="Current Market Price" />
      <input type="number" id="target" placeholder="Target Price (optional)" />
    </div>

    <button id="calcBtn" style="display:none" onclick="calculateAll()">Calculate</button>

    <div class="result" id="avgResult">Average Price: --</div>
    <div class="result" id="summary">Total Quantity: --<br>Invested Amount: --</div>
    <div class="result" id="pl">Profit / Loss: --</div>
    <div class="result" id="targetResult">Target Return: --</div>

    <div class="result">
      <strong>Recent Trades</strong>
      <div id="tradeList">No trades yet</div>
      <button class="small-btn" onclick="clearHistory()">üóëÔ∏è Clear Trade History</button>
      
    </div>
  </div>

  <div class="footer">Created by <span>Tanishk Nr Mamodia</span></div>

  <script>
    function loadHistory() {
      const list = document.getElementById('tradeList');
      const history = JSON.parse(localStorage.getItem('tradeHistory')) || [];

      if (history.length === 0) {
        list.innerText = 'No trades yet';
        return;
      }

      list.innerHTML = history.map((t, i) => `
        <details onclick="loadTrade(${i})">
          <summary>${t.stock} | Avg ‚Çπ${t.avg}</summary>
          Qty: ${t.qty}<br>
          Invested: ‚Çπ${t.invested}<br>
          CMP: ‚Çπ${t.cmp}<br>
          P/L: <span class="${t.pl >= 0 ? 'profit' : 'loss'}">‚Çπ${t.pl} (${t.perc}%)</span><br>
          Date: ${t.date}
        </details>
      `).join('');
    } {
      const list = document.getElementById('tradeList');
      const history = JSON.parse(localStorage.getItem('tradeHistory')) || [];

      if (history.length === 0) {
        list.innerText = 'No trades yet';
        return;
      }

      list.innerHTML = history.map(t => `
        <details>
          <summary>${t.stock} | Avg ‚Çπ${t.avg}</summary>
          Qty: ${t.qty}<br>
          Invested: ‚Çπ${t.invested}<br>
          CMP: ‚Çπ${t.cmp}<br>
          P/L: <span class="${t.pl >= 0 ? 'profit' : 'loss'}">‚Çπ${t.pl} (${t.perc}%)</span><br>
          Date: ${t.date}
        </details>
      `).join('');
    }

    loadHistory();

    function generateInputs() {
      const count = parseInt(document.getElementById('buyCount').value);
      const inputs = document.getElementById('inputs');
      inputs.innerHTML = '';
      if (!count || count <= 0) return;

      for (let i = 1; i <= count; i++) {
        inputs.innerHTML += `
          <div class="row">
            <input type="number" class="price" placeholder="Buy Price ${i}">
            <input type="number" class="qty" placeholder="Quantity ${i}">
          </div>`;
      }
      document.getElementById('calcBtn').style.display = 'block';
    }

    function calculateAll() {
      const prices = document.querySelectorAll('.price');
      const qtys = document.querySelectorAll('.qty');
      let totalCost = 0, totalQty = 0;

      prices.forEach((p, i) => {
        const price = parseFloat(p.value) || 0;
        const qty = parseFloat(qtys[i].value) || 0;
        totalCost += price * qty;
        totalQty += qty;
      });

      if (totalQty === 0) return;

      const avg = totalCost / totalQty;
      document.getElementById('avgResult').innerText = `Average Price: ‚Çπ ${avg.toFixed(2)}`;
      document.getElementById('summary').innerHTML = `Total Quantity: ${totalQty}<br>Invested Amount: ‚Çπ ${totalCost.toFixed(2)}`;

      const cmp = parseFloat(document.getElementById('cmp').value);
      const pl = cmp ? (cmp - avg) * totalQty : 0;
      const perc = cmp ? (((cmp - avg) / avg) * 100).toFixed(2) : 0;

      const plDiv = document.getElementById('pl');
      plDiv.className = 'result ' + (pl >= 0 ? 'profit' : 'loss');
      plDiv.innerText = `Profit / Loss: ‚Çπ ${pl.toFixed(2)} (${perc}%)`;

      const target = parseFloat(document.getElementById('target').value);
      if (target) {
        const exp = (target - avg) * totalQty;
        const expPerc = ((target - avg) / avg) * 100;
        document.getElementById('targetResult').innerText = `Target Return: ‚Çπ ${exp.toFixed(2)} (${expPerc.toFixed(2)}%)`;
      }

      const trade = {
        stock: document.getElementById('stock').value || 'N/A',
        avg: avg.toFixed(2),
        qty: totalQty,
        invested: totalCost.toFixed(2),
        cmp: cmp || 'N/A',
        pl: pl.toFixed(2),
        perc,
        date: new Date().toLocaleString()
      };

      const history = JSON.parse(localStorage.getItem('tradeHistory')) || [];
      history.unshift(trade);
      localStorage.setItem('tradeHistory', JSON.stringify(history.slice(0, 10)));
      loadHistory();
    }

    function clearHistory() {
      localStorage.removeItem('tradeHistory');
      loadHistory();
    }

    function loadTrade(index) {
      const history = JSON.parse(localStorage.getItem('tradeHistory')) || [];
      const t = history[index];
      if (!t) return;

      document.getElementById('stock').value = t.stock;
      document.getElementById('cmp').value = t.cmp !== 'N/A' ? t.cmp : '';

      document.getElementById('avgResult').innerText = `Average Price: ‚Çπ ${t.avg}`;
      document.getElementById('summary').innerHTML = `Total Quantity: ${t.qty}<br>Invested Amount: ‚Çπ ${t.invested}`;

      const plDiv = document.getElementById('pl');
      plDiv.className = 'result ' + (t.pl >= 0 ? 'profit' : 'loss');
      plDiv.innerText = `Profit / Loss: ‚Çπ ${t.pl} (${t.perc}%)`;
    }

    );
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'trade_history.csv';
      a.click();
    }
  </script>
</body>
</html>
